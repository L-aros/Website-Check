# 用户指南

本文以“从零创建一个任务”为主线，覆盖：任务创建、页面内容监控、链接变化监控、新增链接触发附件下载、下载与排障。

## 1. 登录
- 打开前端页面（开发环境通常是 `http://localhost:5173` 或自动递增端口）
- 使用后端配置的 `ADMIN_PASSWORD` 登录

## 2. 创建一个基础监控任务（监控页面内容变化）
适用于：页面某块内容（文本）变化时提醒，例如通知公告、价格、某个标题等。

1. 打开「任务列表」→「新增任务」
2. 填写：
   - URL：要监控的页面地址
   - 选择器类型：CSS 或 XPath
   - 选择器：定位到要监控的区域（系统会取文本内容并做 hash 对比）
   - 频率：cron 表达式（默认每 30 分钟一次）
3. 保存后，系统会按频率执行检查；也可以在任务上点击“立即检测”

### 2.1 只关注“命中条件”的变化（可选）
如果页面变化很多，但你只关心某些关键词/模式（例如“报名”“简章”“录取”），可以在任务高级选项里配置“命中规则”：
- 关键词包含：`matchType=keyword`
- 正则匹配：`matchType=regex`

启用后：只有内容命中规则时才会记录历史并发送通知；未命中会被忽略（避免噪音）。

## 3. 启用“链接变化监控”（适合新闻/公告列表页）
适用于：列表页会不断新增文章链接，但列表页本身不一定改动明显，或者你希望以“新增文章”为触发点。

在创建/编辑任务时开启：
- 「监控页面链接变化」
- （可选）「文章链接范围选择器」：建议填写，避免把导航栏、页脚、logo 等无关链接也纳入链接集合

开启后，任务的“监控内容”将变为链接集合，新增链接会被识别出来（并可在日志/链接列表里查看）。

## 4. 启用“新增链接触发附件下载”（进入文章页找附件）
适用于：附件不在列表页上，而在文章详情页中。

### 4.1 先开系统开关
1. 打开「系统设置」
2. 开启「新增链接时自动查找并下载附件」
3. 配置「每次最多处理新增链接数」（建议 5–20 起步，视站点复杂度调整）

### 4.2 再开任务开关
在创建/编辑任务时开启：
- 「监控页面链接变化」
- 「新增链接时查找并下载附件」
- 配置允许的附件后缀（例如：`pdf,docx,xlsx,zip,rar`）

说明：
- 附件发现/下载严格按“允许后缀”白名单执行，不会把网站图标/图片当作附件下载。
- 首次启用该功能时，系统会按“每次最多处理新增链接数”处理当前页面已存在的链接（作为基线初始化）。

## 5. 日期过滤（只关注某个日期之后的附件）
如果你只关心最近发布/更新的附件：
1. 打开「系统设置」
2. 在「仅监控该日期之后的附件」填写日期或时间戳

建议使用带时区的 ISO 时间避免歧义，例如：`2026-02-06T00:00:00+08:00`。

## 6. 查看下载的附件（/downloads）
1. 打开左侧菜单「已下载附件」
2. 可按任务、文件名、后缀筛选
3. 点击文件名即可下载；来源文章列可一键跳转定位附件所在文章

## 7. 查看历史记录（/history/:monitorId）
在任务历史里你可以看到：
- 变更类型（首次抓取/更新）
- 截图、HTML 快照（快照内相对链接可跳回原站）
- 下载的附件列表（含大小与来源文章）
- 内容差异：点击“查看差异”可对比相邻两次记录的变化，并用颜色高亮新增/删除内容

## 8. 排障建议
当“没下载/下载失败/过滤掉了”时，优先看两类信息：
- 附件日志：是否发现了附件、是否命中过滤、下载失败原因
- 链接日志：是否识别到新增链接、是否成功进入文章页

这些查询接口见 [api.md](api.md)。
